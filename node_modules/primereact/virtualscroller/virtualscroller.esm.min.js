import t,{Component as e}from"react";import{ObjectUtils as o,classNames as r}from"primereact/core";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function h(t,e){return!e||"object"!==c(e)&&"function"!=typeof e?i(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function p(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function f(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,r)}return o}function m(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?f(Object(o),!0).forEach((function(e){p(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):f(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function d(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var v=function(l){a(w,e);var c,p,f,v,g,y=(c=w,p=d(),function(){var t,e=u(c);if(p){var o=u(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return h(this,t)});function w(t){var e;s(this,w);var o=(e=y.call(this,t)).isBoth();return e.state={first:o?{rows:0,cols:0}:0,last:o?{rows:0,cols:0}:0,numItemsInViewport:o?{rows:0,cols:0}:0,numToleratedItems:t.numToleratedItems,loading:!1},e.onScroll=e.onScroll.bind(i(e)),e.lastScrollPos=o?{top:0,left:0}:0,e}return f=w,(v=[{key:"scrollTo",value:function(t){this.element&&this.element.scrollTo(t)}},{key:"scrollToIndex",value:function(t){var e=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"auto",r=this.isBoth(),s=this.isHorizontal(),n=this.state.first,i=this.props.itemSize,l=this.getContentPadding(),a=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t<=e.state.numToleratedItems?0:t},c=function(t,e,o){return t*e+o},h=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.scrollTo({left:t,top:r,behavior:o})};if(r){var u={rows:a(t[0]),cols:a(t[1])};(u.rows!==n.rows||u.cols!==n.cols)&&h(c(u.cols,i[1],l.left),c(u.rows,i[0],l.top))}else{var p=a(t);p!==n&&(s?h(c(p,i,l.left),0):h(0,c(p,i,l.top)))}}},{key:"scrollInView",value:function(t,e){var o=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"auto";if(e){var s=this.isBoth(),n=this.isHorizontal(),i=this.getRenderedRange(),l=i.first,a=i.viewport,c=this.props.itemSize,h=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return o.scrollTo({left:t,top:e,behavior:r})},u="to-start"===e,p="to-end"===e;if(u){if(s)a.first.rows-l.rows>t[0]?h(a.first.cols*c,(a.first.rows-1)*c):a.first.cols-l.cols>t[1]&&h((a.first.cols-1)*c,a.first.rows*c);else if(a.first-l>t){var f=(a.first-1)*c;n?h(f,0):h(0,f)}}else if(p)if(s)a.last.rows-l.rows<=t[0]+1?h(a.first.cols*c,(a.first.rows+1)*c):a.last.cols-l.cols<=t[1]+1&&h((a.first.cols+1)*c,a.first.rows*c);else if(a.last-l<=t+1){var m=(a.first+1)*c;n?h(m,0):h(0,m)}}else this.scrollToIndex(t,r)}},{key:"getRenderedRange",value:function(){var t=this.isBoth(),e=this.isHorizontal(),o=this.state,r=o.first,s=o.last,n=o.numItemsInViewport,i=this.props.itemSize,l=function(t,e){return Math.floor(t/(e||t))},a=r,c=0;if(this.element){var h=this.element.scrollTop,u=this.element.scrollLeft;c=t?{rows:(a={rows:l(h,i[0]),cols:l(u,i[1])}).rows+n.rows,cols:a.cols+n.cols}:(a=l(e?u:h,i))+n}return{first:r,last:s,viewport:{first:a,last:c}}}},{key:"isHorizontal",value:function(){return"horizontal"===this.props.orientation}},{key:"isBoth",value:function(){return"both"===this.props.orientation}},{key:"calculateOptions",value:function(){var t=this,e=this.isBoth(),o=this.isHorizontal(),r=this.state.first,s=this.props.itemSize,n=this.getContentPadding(),i=this.element?this.element.offsetWidth-n.left:0,l=this.element?this.element.offsetHeight-n.top:0,a=function(t,e){return Math.ceil(t/(e||t))},c=e?{rows:a(l,s[0]),cols:a(i,s[1])}:a(o?i:l,s),h=this.state.numToleratedItems||Math.ceil((e?c.rows:c)/2),u=function(e,o,r){return t.getLast(e+o+(e<h?2:3)*h,r)},p={numItemsInViewport:c,last:e?{rows:u(r.rows,c.rows),cols:u(r.cols,c.cols,!0)}:u(r,c),numToleratedItems:h};this.props.showLoader&&(p.loaderArr=Array.from({length:e?c.rows:c})),this.setState(p,(function(){t.props.lazy&&t.props.onLazyLoad&&t.props.onLazyLoad({first:t.state.first,last:t.state.last})}))}},{key:"getLast",value:function(t,e){return this.props.items?Math.min(e?this.props.items[0].length:this.props.items.length,t):0}},{key:"getContentPadding",value:function(){if(this.content){var t=getComputedStyle(this.content),e=parseInt(t.paddingLeft,10),o=parseInt(t.paddingRight,10),r=parseInt(t.paddingTop,10),s=parseInt(t.paddingBottom,10);return{left:e,right:o,top:r,bottom:s,x:e+o,y:r+s}}return{left:0,right:0,top:0,bottom:0,x:0,y:0}}},{key:"setSize",value:function(){var t=this;if(this.element){var e=this.isBoth(),o=this.isHorizontal(),r=this.element.parentElement,s=this.props.scrollWidth||"".concat(this.element.offsetWidth||r.offsetWidth,"px"),n=this.props.scrollHeight||"".concat(this.element.offsetHeight||r.offsetHeight,"px"),i=function(e,o){return t.element.style[e]=o};e?(i("height",n),i("width",s)):o?i("width",s):i("height",n)}}},{key:"setSpacerSize",value:function(){var t=this,e=this.props.items;if(this.spacer&&e){var o=this.isBoth(),r=this.isHorizontal(),s=this.props.itemSize,n=this.getContentPadding(),i=function(e,o,r){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return t.spacer.style[e]=(o||[]).length*r+s+"px"};o?(i("height",e[0],s[0],n.y),i("width",e[1],s[1],n.x)):r?i("width",e,s,n.x):i("height",e,s,n.y)}}},{key:"setContentPosition",value:function(t){var e=this;if(this.content){var o=this.isBoth(),r=this.isHorizontal(),s=t?t.first:this.state.first,n=this.props.itemSize,i=function(t,e){return t*e},l=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.content.style.transform="translate3d(".concat(t,"px, ").concat(o,"px, 0)")};if(o)l(i(s.cols,n[1]),i(s.rows,n[0]));else{var a=i(s,n);r?l(a,0):l(0,a)}}}},{key:"onScrollPositionChange",value:function(t){var e=this,o=t.target,r=this.isBoth(),s=this.isHorizontal(),n=this.state,i=n.first,l=n.last,a=n.numItemsInViewport,c=n.numToleratedItems,h=this.props.itemSize,u=this.getContentPadding(),p=function(t,e){return t?t>e?t-e:t:0},f=function(t,e){return Math.floor(t/(e||t))},m=function(t,e,o,r,s){return t<=c?c:s?o-r-c:e+c-1},d=function(t,e,o,r,s,n){return t<=c?0:n?t<e?o:t-c:t>e?o:t-2*c},v=function(t,o,r,s,n){var i=o+s+2*c;return t>=c&&(i+=c+1),e.getLast(i,n)},g=p(o.scrollTop,u.top),y=p(o.scrollLeft,u.left),w=0,S=l,b=!1;if(r){var z=this.lastScrollPos.top<=g,I=this.lastScrollPos.left<=y,O={rows:f(g,h[0]),cols:f(y,h[1])},P={rows:m(O.rows,i.rows,l.rows,a.rows,z),cols:m(O.cols,i.cols,l.cols,a.cols,I)};w={rows:d(O.rows,P.rows,i.rows,0,0,z),cols:d(O.cols,P.cols,i.cols,0,0,I)},S={rows:v(O.rows,w.rows,0,a.rows),cols:v(O.cols,w.cols,0,a.cols,!0)},b=w.rows!==i.rows||w.cols!==i.cols||S.rows!==l.rows||S.cols!==l.cols,this.lastScrollPos={top:g,left:y}}else{var T=s?y:g,k=this.lastScrollPos<=T,C=f(T,h);S=v(C,w=d(C,m(C,i,l,a,k),i,0,0,k),0,a),b=w!==i||S!==l,this.lastScrollPos=T}return{first:w,last:S,isRangeChanged:b}}},{key:"onScrollChange",value:function(t){var e=this,o=this.onScrollPositionChange(t);if(o.isRangeChanged){var r={first:o.first,last:o.last};this.setContentPosition(r),this.props.lazy&&this.props.onLazyLoad&&this.props.onLazyLoad(r),this.setState(r,(function(){e.props.onScrollIndexChange&&e.props.onScrollIndexChange(r)}))}}},{key:"onScroll",value:function(t){var e=this;this.props.onScroll&&this.props.onScroll(t),this.props.delay?(this.scrollTimeout&&clearTimeout(this.scrollTimeout),!this.state.loading&&this.props.showLoader&&this.onScrollPositionChange(t).isRangeChanged&&this.setState({loading:!0}),this.scrollTimeout=setTimeout((function(){e.onScrollChange(t),e.state.loading&&e.props.showLoader&&!e.props.lazy&&e.setState({loading:!1})}),this.props.delay)):this.onScrollChange(t)}},{key:"getOptions",value:function(t,e){return{index:t,count:e,first:0===t,last:t===e-1,even:t%2==0,odd:t%2!=0,props:this.props}}},{key:"init",value:function(){this.setSize(),this.calculateOptions(),this.setSpacerSize()}},{key:"componentDidMount",value:function(){this.init()}},{key:"componentDidUpdate",value:function(t,e){t.itemSize===this.props.itemSize&&t.items&&t.items.length===(this.props.items||[]).length||this.init(),this.props.lazy&&t.loading!==this.props.loading&&this.state.loading!==this.props.loading&&this.setState({loading:this.props.loading}),t.orientation!==this.props.orientation&&(this.lastScrollPos=this.isBoth()?{top:0,left:0}:0)}},{key:"renderItem",value:function(e,r,s,n){var i=this.getOptions(r,s),l=o.getJSXElement(this.props.itemTemplate,n||e,i);return t.createElement(t.Fragment,{key:r},l)}},{key:"renderItems",value:function(){var t=this,e=this.props.items;if(e&&!this.state.loading){var o=this.isBoth(),r=this.state,s=r.first,n=r.last,i=e.length;return o?e.slice(s.rows,n.rows).map((function(e,o){var r=e.slice(s.cols,n.cols);return t.renderItem(e,s.rows+o,i,r)})):e.slice(s,n).map((function(e,o){return t.renderItem(e,s+o,i)}))}return null}},{key:"renderLoaderItem",value:function(e,r,s){var n=m(m({},this.getOptions(e,r)),s||{}),i=o.getJSXElement(this.props.loadingTemplate,n);return t.createElement(t.Fragment,{key:e},i)}},{key:"renderLoader",value:function(){var e=this;if(this.state.loading){var o=r("p-virtualscroller-loader",{"p-component-overlay":!this.props.loadingTemplate}),s=t.createElement("i",{className:"p-virtualscroller-loading-icon pi pi-spinner pi-spin"});if(this.props.loadingTemplate){var n=this.isBoth(),i=this.state.numItemsInViewport,l=n?i.rows:i;s=this.state.loaderArr.map((function(t,o){return e.renderLoaderItem(o,l,n&&{numCols:i.cols})}))}return t.createElement("div",{className:o},s)}return null}},{key:"renderContent",value:function(){var e=this,r=this.renderItems(),s=t.createElement("div",{className:"p-virtualscroller-content",ref:function(t){return e.content=t}},r);if(this.props.contentTemplate){var n=this.state;return o.getJSXElement(this.props.contentTemplate,{className:"p-virtualscroller-content",ref:function(t){return e.content=t},children:r,element:s,props:this.props,loading:n.loading,first:n.first,last:n.last})}return s}},{key:"render",value:function(){var e=this,o=this.isBoth(),s=this.isHorizontal(),n=r("p-virtualscroller",{"p-both-scroll":o,"p-horizontal-scroll":s},this.props.className),i=this.renderLoader(),l=this.renderContent();return t.createElement("div",{ref:function(t){return e.element=t},className:n,tabIndex:0,style:this.props.style,onScroll:this.onScroll},l,t.createElement("div",{ref:function(t){return e.spacer=t},className:"p-virtualscroller-spacer"}),i)}}])&&n(f.prototype,v),g&&n(f,g),w}();p(v,"defaultProps",{id:null,style:null,className:null,items:null,itemSize:0,scrollHeight:null,scrollWidth:null,orientation:"vertical",numToleratedItems:null,delay:0,lazy:!1,showLoader:!1,loadingTemplate:null,itemTemplate:null,contentTemplate:null,onScroll:null,onScrollIndexChange:null,onLazyLoad:null});export{v as VirtualScroller};
